@model IEnumerable<Tienda.Models.Producto>
@{
    ViewBag.Title = "Catalogo";
}

<div class="row">
    <div class="col-lg-offset-10">
        <label style="margin-left: 15px;">Cesta:</label>
        <span id="spnCart" class="label label-info ">@ViewBag.cartCount</span>
        <br />
    </div>
</div>
<hr />


<div class="row" id="Catalogo">
    <div class="col-md-2" id="menu">

        <h4 class="title-w3ls">Filtrar por:</h4>
        <div class="nav-divider divider"></div>
        <ul class="nav nav-list" style="margin-left: 15px;">
            <li><a>Camaras</a></li>
            <li><a>Radios</a></li>
            <li><a>Transmisores</a></li>
            <li><a>Alarmas</a></li>
        </ul>
        <br />
        <br />
    </div>
    <div class="col-md-9">

        @foreach (var item in Model)
        {
            <div class="col-sm-6 col-md-4">

                <div class="thumbnail">

                    <h4><span class="center-block text-center thin para-w3-agile">@item.Nombre</span></h4>

                    <a href="@Url.Action("Detalles","Inicio",new { id = item.Id })"><img alt="@item.Nombre" src="@Url.Content(item.DetalleProducto.FirstOrDefault().ImagenUrl)" class="img-thumbnail " style="width: 200px; height: 210px;" /></a>

                    <h4 class="text-center para-w3-agile"><span class="thin"> @string.Format("{0:c0}", item.Precio) </span></h4>
                    @if (User.Identity.IsAuthenticated)
                    {
                        <div class="divAddCart btn btn-success" style="margin-left: 44%;" id="@item.Id"><i class="ion-bag"></i></div>
                    }
                </div>
                <br />
                <br />
            </div>
        }
    </div>
</div>



<div class="modal fade bd-example-modal-lg" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true"></div>

@section scripts
{
    <script>
    $(document).ready(function () {

        $('.divAddCart').on('click', function () {
            var getItemId = $(this).attr("id");
            var getUserName = $('.divName').html();
            $.ajax({
                type: 'POST',
                contentType: 'application/json; charset=utf-8',
                url: '@Url.Action("AddCart")',
                data: "{ 'itemId':' " + getItemId + "' }",
                success: function (data) {
                    $('#spnCart').html(data)
                },
                error: function (data) {
                    alert(data);
                }
            });
        });

        $('#spnCart').on('click', function () {
            var getName = $('.divName').html();
            $.ajax({
                type: 'POST',
                contentType: 'application/json; charset=utf-8',
                url: '@Url.Action("GetCartItems")',
                success: function (data) {
                    $('#exampleModal').html(data);
                    $('#exampleModal').modal({

                    });
                },
                error: function (data) {
                    alert(data);
                }
            });
        });

        $(document).delegate('.cartDel', 'click', function () {
            var getItemId = $(this).attr("id");
            $.ajax({
                type: 'POST',
                contentType: 'application/json; charset=utf-8',
                url: '@Url.Action("DeleteCart")',
                data: "{ 'itemId':' " + getItemId + "' }",
                success: function (data) {
                    $('#exampleModal').html(data);
                    $('#spnCart').html($(data).find('#cartList tbody tr').length);
                    $('#exampleModal').modal({

                    });
                },
                error: function (data) {
                    alert(data);
                }
            });
        });

         $(document).delegate('.cartsum', 'click', function () {
            var getItemId = $(this).attr("id");
            $.ajax({
                type: 'POST',
                contentType: 'application/json; charset=utf-8',
                url: '@Url.Action("Cestasum")',
                data: "{ 'id':' " + getItemId + "' }",
                success: function (data) {
                    $('#exampleModal').html(data);
                    $('#spnCart').html($(data).find('#cartList tbody tr').length);
                    $('#exampleModal').modal({

                    });
                },
                error: function (data) {
                    alert(data);
                }
            });
        });

           $(document).delegate('.cartrest', 'click', function () {
            var getItemId = $(this).attr("id");
            $.ajax({
                type: 'POST',
                contentType: 'application/json; charset=utf-8',
                url: '@Url.Action("Cestarest")',
                data: "{ 'id':' " + getItemId + "' }",
                success: function (data) {
                    $('#exampleModal').html(data);
                    $('#spnCart').html($(data).find('#cartList tbody tr').length);
                    $('#exampleModal').modal({

                    });
                },
                error: function (data) {
                    alert(data);
                }
            });
        });
    });
    </script>
}
@model IEnumerable<Tienda.Models.Producto>
@{
    ViewBag.Title = "Catalogo";
}
<div class="top">
    <div class="divName">@ViewBag.userName</div>
    <div class="container">
        <h4 class="title-w3ls ">Catalogo:</h4>

        <div class="row">
            <div class="col-md-2">
                <br />
                <br />
                <ul style="margin-left:15px;">
                    <li>Camaras</li>
                    <li>Radios</li>
                    <li>Transmisores</li>
                    <li>Alarmas</li>
                </ul>
                <br />
                <br />
            </div>
            <div class="col-md-10">
                <label style="margin-left:15px;"> Cesta:</label> <span id="spnCart" class="label label-info "> @ViewBag.cartCount</span>
                <br />
                <br />
                @foreach (var item in Model)
                {

                    <div class="col-sm-6 col-md-4">
                        <div class="thumbnail" style="width:100%;height:100%;">

                            <h3 class="para-w3-agile"><span class="center-block text-center thin">@item.Nombre</span></h3>
                            @if (item.DetalleProducto.FirstOrDefault().ImagenUrl != null)
                            {
                                <img alt="@item.Nombre" src="@Url.Content(item.DetalleProducto.FirstOrDefault().ImagenUrl)" class="img-thumbnail " style="width:200px;height:210px;" />
                            }
                            <h3 class="text-center para-w3-agile"><span class="thin">@string.Format("{0:c0}", item.Precio)</span></h3>

                            <div class="divAddCart btn btn-success" style="margin-left:44%;" id="@item.Id"><i class="ion-bag"></i></div>
                        </div>
                    </div>
                }
            </div>

        </div>
    </div>

</div>

<div class="modal fade bd-example-modal-lg" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true"></div>

@section scripts
{
    <script>
    $(document).ready(function () {

        $('.divAddCart').on('click', function () {
            var getItemId = $(this).attr("id");
            var getUserName = $('.divName').html();
            $.ajax({
                type: 'POST',
                contentType: 'application/json; charset=utf-8',
                url: '@Url.Action("AddCart")',
                data: "{ 'itemId':' " + getItemId + "' }",
                success: function (data) {
                    $('#spnCart').html(data)
                },
                error: function (data) {
                    alert(data);
                }
            });
        });

        $('#spnCart').on('click', function () {
            var getName = $('.divName').html();
            $.ajax({
                type: 'POST',
                contentType: 'application/json; charset=utf-8',
                url: '@Url.Action("GetCartItems")',
                success: function (data) {
                    $('#exampleModal').html(data);
                    $('#exampleModal').modal({

                    });
                },
                error: function (data) {
                    alert(data);
                }
            });
        });

        $(document).delegate('.cartDel', 'click', function () {
            var getItemId = $(this).attr("id");
            $.ajax({
                type: 'POST',
                contentType: 'application/json; charset=utf-8',
                url: '@Url.Action("DeleteCart")',
                data: "{ 'itemId':' " + getItemId + "' }",
                success: function (data) {
                    $('#exampleModal').html(data);
                    $('#spnCart').html($(data).find('#cartList tbody tr').length);
                    $('#exampleModal').modal({

                    });
                },
                error: function (data) {
                    alert(data);
                }
            });
        });
    });
    </script>
}